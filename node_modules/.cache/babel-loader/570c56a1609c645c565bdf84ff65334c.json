{"ast":null,"code":"var _jsxFileName = \"/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/providers/UserProvider.js\";\nimport React, { useEffect, useState } from \"react\";\nimport AuthService from \"../services/AuthService\";\nimport { navigate } from \"@reach/router\";\nimport { useSnackbar } from \"notistack\";\nimport { getErrorMessage } from \"../helpers/functions\";\nexport const UserContext = React.createContext();\n\nfunction UserProvider({\n  children\n}) {\n  const [token, setToken] = useState(null);\n  const [userObject, setUserObject] = useState({});\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  useEffect(() => {\n    try {\n      function getToken() {\n        try {\n          const local_token = localStorage.getItem(\"auth_token\");\n          if (local_token) setToken(local_token);\n        } catch (error) {\n          console.log(error);\n        }\n      }\n\n      getToken();\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n  useEffect(() => {\n    async function fetchUserProfile() {\n      try {\n        const user = await AuthService.profile();\n\n        if (user === null || user === void 0 ? void 0 : user.me) {\n          setUserObject(user.me);\n        }\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\"\n        });\n      }\n    }\n\n    try {\n      if (token) {\n        if (token === \"logged_out\") {\n          localStorage.setItem(\"auth_token\", \"\");\n          navigate(\"/\");\n          setUserObject({});\n          setToken(null);\n        } else {\n          localStorage.setItem(\"auth_token\", token);\n          fetchUserProfile();\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }, [token]);\n  const value = React.useMemo(() => {\n    return {\n      token,\n      setToken,\n      userObject,\n      setUserObject\n    };\n  }, [token, setToken, userObject, setUserObject]);\n  return /*#__PURE__*/React.createElement(UserContext.Provider, {\n    value: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 10\n    }\n  }, children);\n}\n\nexport default UserProvider;","map":{"version":3,"sources":["/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/providers/UserProvider.js"],"names":["React","useEffect","useState","AuthService","navigate","useSnackbar","getErrorMessage","UserContext","createContext","UserProvider","children","token","setToken","userObject","setUserObject","enqueueSnackbar","getToken","local_token","localStorage","getItem","error","console","log","fetchUserProfile","user","profile","me","message","variant","setItem","value","useMemo"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,OAAOC,WAAP,MAAwB,yBAAxB;AACA,SAASC,QAAT,QAAyB,eAAzB;AACA,SAASC,WAAT,QAA4B,WAA5B;AACA,SAASC,eAAT,QAAgC,sBAAhC;AAEA,OAAO,MAAMC,WAAW,GAAGP,KAAK,CAACQ,aAAN,EAApB;;AAEP,SAASC,YAAT,CAAsB;AAAEC,EAAAA;AAAF,CAAtB,EAAoC;AAClC,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBV,QAAQ,CAAC,IAAD,CAAlC;AACA,QAAM,CAACW,UAAD,EAAaC,aAAb,IAA8BZ,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM;AAAEa,IAAAA;AAAF,MAAsBV,WAAW,EAAvC;AAEAJ,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI;AACF,eAASe,QAAT,GAAoB;AAClB,YAAI;AACF,gBAAMC,WAAW,GAAGC,YAAY,CAACC,OAAb,CAAqB,YAArB,CAApB;AACA,cAAIF,WAAJ,EAAiBL,QAAQ,CAACK,WAAD,CAAR;AAClB,SAHD,CAGE,OAAOG,KAAP,EAAc;AACdC,UAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACF;;AACDJ,MAAAA,QAAQ;AACT,KAVD,CAUE,OAAOI,KAAP,EAAc;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACF,GAdQ,EAcN,EAdM,CAAT;AAgBAnB,EAAAA,SAAS,CAAC,MAAM;AACd,mBAAesB,gBAAf,GAAkC;AAChC,UAAI;AACF,cAAMC,IAAI,GAAG,MAAMrB,WAAW,CAACsB,OAAZ,EAAnB;;AACA,YAAID,IAAJ,aAAIA,IAAJ,uBAAIA,IAAI,CAAEE,EAAV,EAAc;AACZZ,UAAAA,aAAa,CAACU,IAAI,CAACE,EAAN,CAAb;AACD;AACF,OALD,CAKE,OAAON,KAAP,EAAc;AACd,cAAMO,OAAO,GAAGrB,eAAe,CAACc,KAAD,CAA/B;AACAL,QAAAA,eAAe,CAACY,OAAD,EAAU;AACvBC,UAAAA,OAAO,EAAE;AADc,SAAV,CAAf;AAGD;AACF;;AACD,QAAI;AACF,UAAIjB,KAAJ,EAAW;AACT,YAAIA,KAAK,KAAK,YAAd,EAA4B;AAC1BO,UAAAA,YAAY,CAACW,OAAb,CAAqB,YAArB,EAAmC,EAAnC;AACAzB,UAAAA,QAAQ,CAAC,GAAD,CAAR;AACAU,UAAAA,aAAa,CAAC,EAAD,CAAb;AACAF,UAAAA,QAAQ,CAAC,IAAD,CAAR;AACD,SALD,MAKO;AACLM,UAAAA,YAAY,CAACW,OAAb,CAAqB,YAArB,EAAmClB,KAAnC;AACAY,UAAAA,gBAAgB;AACjB;AACF;AACF,KAZD,CAYE,OAAOH,KAAP,EAAc;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACF,GA7BQ,EA6BN,CAACT,KAAD,CA7BM,CAAT;AA+BA,QAAMmB,KAAK,GAAG9B,KAAK,CAAC+B,OAAN,CAAc,MAAM;AAChC,WAAO;AACLpB,MAAAA,KADK;AAELC,MAAAA,QAFK;AAGLC,MAAAA,UAHK;AAILC,MAAAA;AAJK,KAAP;AAMD,GAPa,EAOX,CAACH,KAAD,EAAQC,QAAR,EAAkBC,UAAlB,EAA8BC,aAA9B,CAPW,CAAd;AASA,sBAAO,oBAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAEgB,KAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAqCpB,QAArC,CAAP;AACD;;AAED,eAAeD,YAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport AuthService from \"../services/AuthService\";\nimport { navigate } from \"@reach/router\";\nimport { useSnackbar } from \"notistack\";\nimport { getErrorMessage } from \"../helpers/functions\";\n\nexport const UserContext = React.createContext();\n\nfunction UserProvider({ children }) {\n  const [token, setToken] = useState(null);\n  const [userObject, setUserObject] = useState({});\n  const { enqueueSnackbar } = useSnackbar();\n\n  useEffect(() => {\n    try {\n      function getToken() {\n        try {\n          const local_token = localStorage.getItem(\"auth_token\");\n          if (local_token) setToken(local_token);\n        } catch (error) {\n          console.log(error);\n        }\n      }\n      getToken();\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n\n  useEffect(() => {\n    async function fetchUserProfile() {\n      try {\n        const user = await AuthService.profile();\n        if (user?.me) {\n          setUserObject(user.me);\n        }\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\",\n        });\n      }\n    }\n    try {\n      if (token) {\n        if (token === \"logged_out\") {\n          localStorage.setItem(\"auth_token\", \"\");\n          navigate(\"/\");\n          setUserObject({});\n          setToken(null);\n        } else {\n          localStorage.setItem(\"auth_token\", token);\n          fetchUserProfile();\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }, [token]);\n\n  const value = React.useMemo(() => {\n    return {\n      token,\n      setToken,\n      userObject,\n      setUserObject,\n    };\n  }, [token, setToken, userObject, setUserObject]);\n\n  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;\n}\n\nexport default UserProvider;\n"]},"metadata":{},"sourceType":"module"}