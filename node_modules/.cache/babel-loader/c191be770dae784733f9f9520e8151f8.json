{"ast":null,"code":"var _jsxFileName = \"/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/pages/OtpPage/index.js\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { OTPContainer } from \"./Styles\";\nimport { Center } from \"../../../styles/component/style\";\nimport { Otp } from \"../../common/Otp/Otp\";\nimport { Header } from \"../../internal/Header/Header\";\nimport { navigate } from \"@reach/router\";\nimport AuthService from \"../../../services/AuthService\";\nimport { getErrorMessage } from \"../../../helpers/functions\";\nimport { useSnackbar } from \"notistack\";\nimport _ from \"lodash\";\nimport useUser from \"../../../hooks/useUser\";\nimport useIfLoggedIn from \"../../../hooks/useIfLoggedIn\";\nimport useLoader from \"../../../hooks/useLoader\";\nimport labels from \"../../../helpers/labels.json\";\n\nconst Index = ({\n  location\n}) => {\n  var _state$payload;\n\n  const [value, setValue] = useState(\"\");\n  const {\n    state\n  } = location;\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    setToken\n  } = useUser();\n  useIfLoggedIn();\n  const {\n    setLoader\n  } = useLoader();\n  const codeRef = useRef(undefined);\n  const [sending, setSending] = useState(false);\n\n  const resendOtp = async () => {\n    try {\n      setLoader({\n        state: true\n      });\n      const response = await AuthService.verifications(state.payload);\n      clearInputs();\n\n      if (response) {\n        enqueueSnackbar(\"OTP Sent Successfully\", {\n          variant: \"success\"\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({\n        state: false\n      });\n    }\n  };\n\n  const clearInputs = () => {\n    if (codeRef.current.textInput[0]) codeRef.current.textInput[0].focus();\n    codeRef.current.state.input[0] = \"\";\n    codeRef.current.state.input[1] = \"\";\n    codeRef.current.state.input[2] = \"\";\n    codeRef.current.state.input[3] = \"\";\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setLoader({\n        state: true\n      });\n      setSending(true);\n\n      let payload = _.pick(state.payload, [\"mobile\"]);\n\n      payload.mobileToken = value;\n      payload.idToken = state.idToken;\n      const response = await AuthService.validateMobile(payload);\n\n      if (response.message === \"Invalid Verification!\") {\n        enqueueSnackbar(\"Invalid OTP\", {\n          variant: \"error\"\n        });\n      }\n\n      if (response && response.token) {\n        setToken(response.token);\n        navigate(\"/create-profile\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({\n        state: false\n      });\n      setSending(false);\n    }\n  };\n\n  useEffect(() => {\n    const enterHandler = event => {\n      if (!sending) {\n        if (codeRef.current) {\n          if (codeRef.current.state.value.length === 4) {\n            if (event.key === \"Enter\") {\n              handleSubmit();\n            }\n          }\n        }\n      }\n    };\n\n    window.addEventListener(\"keyup\", enterHandler);\n    return () => {\n      window.removeEventListener(\"keyup\", enterHandler);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, codeRef]);\n\n  const editTriggered = () => {\n    if (state === null || state === void 0 ? void 0 : state.idToken) {\n      navigate(\"/google-signup\", {\n        state: {\n          payload: state === null || state === void 0 ? void 0 : state.payload,\n          idToken: state.idToken,\n          profileObj: state.profileObj\n        }\n      });\n    } else {\n      navigate(\"/signup\", {\n        state: {\n          payload: state.values\n        }\n      });\n    }\n  };\n\n  if (!(state === null || state === void 0 ? void 0 : (_state$payload = state.payload) === null || _state$payload === void 0 ? void 0 : _state$payload.mobile)) {\n    navigate(-1);\n  }\n\n  return /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Center, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(OTPContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Otp, {\n    heading: labels[\"onboarding.step2\"],\n    disableSubmit: value.length < 4,\n    submitLabel: labels.proceed,\n    phoneNumber: `${state === null || state === void 0 ? void 0 : state.payload.mobile}`,\n    timer: 60,\n    isTimmerEnabel: true,\n    triggerResent: resendOtp,\n    triggerEdit: editTriggered,\n    numberOfInput: 4,\n    inputName: \"otp\",\n    value: value,\n    setValue: setValue,\n    handleSubmit: handleSubmit,\n    codeRef: codeRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default Index;","map":{"version":3,"sources":["/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/pages/OtpPage/index.js"],"names":["React","useState","useRef","useEffect","OTPContainer","Center","Otp","Header","navigate","AuthService","getErrorMessage","useSnackbar","_","useUser","useIfLoggedIn","useLoader","labels","Index","location","value","setValue","state","enqueueSnackbar","setToken","setLoader","codeRef","undefined","sending","setSending","resendOtp","response","verifications","payload","clearInputs","variant","error","message","console","log","current","textInput","focus","input","handleSubmit","pick","mobileToken","idToken","validateMobile","token","enterHandler","event","length","key","window","addEventListener","removeEventListener","editTriggered","profileObj","values","mobile","proceed"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { OTPContainer } from \"./Styles\";\nimport { Center } from \"../../../styles/component/style\";\nimport { Otp } from \"../../common/Otp/Otp\";\nimport { Header } from \"../../internal/Header/Header\";\nimport { navigate } from \"@reach/router\";\nimport AuthService from \"../../../services/AuthService\";\nimport { getErrorMessage } from \"../../../helpers/functions\";\nimport { useSnackbar } from \"notistack\";\nimport _ from \"lodash\";\nimport useUser from \"../../../hooks/useUser\";\nimport useIfLoggedIn from \"../../../hooks/useIfLoggedIn\";\nimport useLoader from \"../../../hooks/useLoader\";\nimport labels from \"../../../helpers/labels.json\";\n\nconst Index = ({ location }) => {\n  const [value, setValue] = useState(\"\");\n  const { state } = location;\n  const { enqueueSnackbar } = useSnackbar();\n  const { setToken } = useUser();\n  useIfLoggedIn();\n  const { setLoader } = useLoader();\n  const codeRef = useRef(undefined);\n  const [sending, setSending] = useState(false);\n  const resendOtp = async () => {\n    try {\n      setLoader({ state: true });\n      const response = await AuthService.verifications(state.payload);\n      clearInputs();\n      if (response) {\n        enqueueSnackbar(\"OTP Sent Successfully\", {\n          variant: \"success\",\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({ state: false });\n    }\n  };\n\n  const clearInputs = () => {\n    if (codeRef.current.textInput[0]) codeRef.current.textInput[0].focus();\n    codeRef.current.state.input[0] = \"\";\n    codeRef.current.state.input[1] = \"\";\n    codeRef.current.state.input[2] = \"\";\n    codeRef.current.state.input[3] = \"\";\n  };\n  const handleSubmit = async () => {\n    try {\n      setLoader({ state: true });\n      setSending(true);\n      let payload = _.pick(state.payload, [\"mobile\"]);\n      payload.mobileToken = value;\n      payload.idToken = state.idToken;\n      const response = await AuthService.validateMobile(payload);\n      if (response.message === \"Invalid Verification!\") {\n        enqueueSnackbar(\"Invalid OTP\", {\n          variant: \"error\",\n        });\n      }\n      if (response && response.token) {\n        setToken(response.token);\n        navigate(\"/create-profile\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({ state: false });\n      setSending(false);\n    }\n  };\n\n  useEffect(() => {\n    const enterHandler = (event) => {\n      if (!sending) {\n        if (codeRef.current) {\n          if (codeRef.current.state.value.length === 4) {\n            if (event.key === \"Enter\") {\n              handleSubmit();\n            }\n          }\n        }\n      }\n    };\n    window.addEventListener(\"keyup\", enterHandler);\n    return () => {\n      window.removeEventListener(\"keyup\", enterHandler);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, codeRef]);\n\n  const editTriggered = () => {\n    if (state?.idToken) {\n      navigate(\"/google-signup\", {\n        state: {\n          payload: state?.payload,\n          idToken: state.idToken,\n          profileObj: state.profileObj,\n        },\n      });\n    } else {\n      navigate(\"/signup\", {\n        state: {\n          payload: state.values,\n        },\n      });\n    }\n  };\n\n  if (!state?.payload?.mobile) {\n    navigate(-1);\n  }\n  return (\n    <Header>\n      <Center>\n        <OTPContainer>\n          <Otp\n            heading={labels[\"onboarding.step2\"]}\n            disableSubmit={value.length < 4}\n            submitLabel={labels.proceed}\n            phoneNumber={`${state?.payload.mobile}`}\n            timer={60}\n            isTimmerEnabel={true}\n            triggerResent={resendOtp}\n            triggerEdit={editTriggered}\n            numberOfInput={4}\n            inputName=\"otp\"\n            value={value}\n            setValue={setValue}\n            handleSubmit={handleSubmit}\n            codeRef={codeRef}\n          />\n        </OTPContainer>\n      </Center>\n    </Header>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}