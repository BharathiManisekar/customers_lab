{"ast":null,"code":"var _jsxFileName = \"/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/internal/CaseCart/index.js\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { PageWrapper, Heading, TableWrapper, Footer, Hr, Row, TextWrapper, Text, TextBold, HyperLink, StyledTitle, Payment, PayLater, Button, TopCenter } from \"./Styles\";\nimport { PrimaryCTAButton } from \"../../common/Buttons\";\nimport CustomTable from \"../../common/CustomTable/CustomTable\";\nimport { Header } from \"../Header/Header\";\nimport useRazorPay from \"../../../hooks/useRazorPay\";\nimport queryString from \"query-string\";\nimport CaseService from \"../../../services/CaseService\";\nimport _ from \"lodash\";\nimport CartService from \"../../../services/CartService\";\nimport useLoader from \"../../../hooks/useLoader\";\nimport { useSnackbar } from \"notistack\";\nimport { getErrorMessage, parseTimeStamp, renderStatus } from \"../../../helpers/functions\";\nimport { addAllCart, addCartItems, removeAllCart, removeCartItems } from \"./functions\";\nimport useUser from \"../../../hooks/useUser\";\nimport moment from \"moment\";\nimport useCartCount from \"../../../hooks/useCartCount\";\nimport { navigate } from \"@reach/router\";\nimport { CLAIMENT_STR, PAYMENT_STATUS_CART } from \"../../../helpers/constants\";\nimport labels from \"../../../helpers/labels.json\";\nimport { CartSplitUp } from \"../CartSplitUp\";\nimport useAlert from \"../../../hooks/useAlert\";\nimport { setIn } from \"formik\";\n\nasync function getCases(query = \"\") {\n  try {\n    const response = await CaseService.getCases(query);\n    return { ...response\n    };\n  } catch (error) {\n    throw error;\n  }\n}\n\nconst Index = () => {\n  var _state$data;\n\n  const openRazorPay = useRazorPay();\n  const [state, setState] = useState();\n  const [caseItems, setCaseItems] = useState([]); // eslint-disable-next-line no-unused-vars\n\n  const [cartDetails, setCartDetails] = useState({});\n  const {\n    userObject\n  } = useUser();\n  const placeholderText = \"Search Cart\";\n  const {\n    setLoader\n  } = useLoader();\n  const MTRef = useRef();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    setTriggerCount\n  } = useCartCount();\n  const {\n    showAlert,\n    hideAlert\n  } = useAlert();\n\n  async function getCart(toChange = true) {\n    try {\n      const response = await CartService.getCart();\n\n      if (response) {\n        if (toChange) MTRef.current.onSearchChange(\"\");\n        setCartDetails(response.cart);\n        setCaseItems(response.cartItems);\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n    }\n  }\n\n  useEffect(() => {\n    async function unSelectAll() {\n      try {\n        await removeAllCart([]);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\"\n        });\n      }\n    }\n\n    unSelectAll(); // commented for https://app.clickup.com/t/3qev6h\n    // getCart();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    if (state === null || state === void 0 ? void 0 : state.message) {\n      enqueueSnackbar(state.message, {\n        variant: \"error\"\n      });\n      navigate(\"/dashboard\");\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [state]);\n  const columns = [{\n    field: \"id\",\n    title: labels[\"table.case_id\"],\n    tooltip: \"Unique Identifier for the Case across JustAct platform\",\n    sorting: false,\n    render: rowData => /*#__PURE__*/React.createElement(HyperLink, {\n      onClick: () => navigate(`/dashboard/cases/${rowData.id}?caseType=${rowData === null || rowData === void 0 ? void 0 : rowData.resolutionKind}`),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TopCenter, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 11\n      }\n    }, rowData.id))\n  }, {\n    field: \"title\",\n    title: labels[\"table.case_title\"],\n    sorting: false,\n    render: rowData => /*#__PURE__*/React.createElement(StyledTitle, {\n      onClick: () => navigate(`/dashboard/cases/${rowData.id}`),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }\n    }, rowData.title)\n  }, {\n    field: \"paryname\",\n    title: labels[\"table.party_name\"],\n    sorting: false,\n    render: rowData => {\n      var _rowData$claimantPart, _rowData$respondentPa;\n\n      return /*#__PURE__*/React.createElement(StyledTitle, {\n        style: {\n          cursor: \"default\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }\n      }, (rowData === null || rowData === void 0 ? void 0 : rowData.agentRole) === CLAIMENT_STR ? rowData === null || rowData === void 0 ? void 0 : (_rowData$claimantPart = rowData.claimantParty) === null || _rowData$claimantPart === void 0 ? void 0 : _rowData$claimantPart.name : /*#__PURE__*/React.createElement(React.Fragment, null, (rowData === null || rowData === void 0 ? void 0 : (_rowData$respondentPa = rowData.respondentParty) === null || _rowData$respondentPa === void 0 ? void 0 : _rowData$respondentPa.name) ? rowData.respondentParty.name : (rowData === null || rowData === void 0 ? void 0 : rowData.respondentName) ? rowData.respondentName : /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          marginLeft: 35\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 17\n        }\n      }, \"-\")));\n    }\n  }, {\n    field: \"amount\",\n    title: labels[\"table.amount\"],\n    sorting: false,\n    render: rowData => {\n      var _rowData$fee;\n\n      return \"INR \" + Number(rowData === null || rowData === void 0 ? void 0 : (_rowData$fee = rowData.fee) === null || _rowData$fee === void 0 ? void 0 : _rowData$fee.total).toFixed(2);\n    }\n  }, {\n    field: \"created_at\",\n    title: labels[\"table.due\"],\n    sorting: true,\n    render: rowData => rowData.submittedOn ? moment(rowData.submittedOn).add(7, \"days\").format(\"DD/MM/YYYY\") : moment(parseTimeStamp(rowData.created_at)).add(7, \"days\").format(\"DD/MM/YYYY\")\n  }, {\n    field: \"details\",\n    title: labels[\"table.description\"],\n    sorting: false,\n    render: rowData => {\n      var _PAYMENT_STATUS_CART$;\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, (rowData === null || rowData === void 0 ? void 0 : rowData.subscriptionKind) === \"adhoc\" ? \"Platform Fee\" : renderStatus((_PAYMENT_STATUS_CART$ = PAYMENT_STATUS_CART[rowData === null || rowData === void 0 ? void 0 : rowData.status]) === null || _PAYMENT_STATUS_CART$ === void 0 ? void 0 : _PAYMENT_STATUS_CART$.value, rowData));\n    }\n  }];\n\n  function getCheckedData(rowData) {\n    const found = caseItems.find(item => item.caseId === rowData.id);\n\n    if (found) {\n      return true;\n    }\n\n    return false;\n  }\n\n  const data = query => new Promise(resolve => {\n    var _query$orderBy;\n\n    let params = {\n      page: query.page + 1,\n      perPage: 50,\n      inCart: true\n    };\n\n    if (query.search) {\n      params.search = query.search;\n    }\n\n    if ((_query$orderBy = query.orderBy) === null || _query$orderBy === void 0 ? void 0 : _query$orderBy.field) {\n      params.sort = query.orderBy.field;\n      params.sortDirection = query.orderDirection;\n    }\n\n    let stringParams = `?${queryString.stringify(params)}`;\n    getCases(stringParams).then(async result => {\n      if (result) {\n        var _result$data;\n\n        const rowData = result === null || result === void 0 ? void 0 : (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.map(row => ({ ...row,\n          tableData: {\n            checked: getCheckedData(row)\n          }\n        }));\n        resolve({\n          data: rowData,\n          page: result.page - 1,\n          total: result.total,\n          lastPage: result.lastPage\n        });\n        setState({\n          data: rowData,\n          page: result.page - 1,\n          total: result.total,\n          lastPage: result.lastPage\n        });\n      }\n    }).catch(error => {\n      enqueueSnackbar(getErrorMessage(error), {\n        variant: \"error\"\n      });\n      setState({\n        data: [],\n        lastPage: 1,\n        page: 1,\n        perPage: 10,\n        total: 0\n      });\n      resolve({\n        data: [],\n        page: 0,\n        total: 0\n      });\n    });\n  });\n\n  async function capturePayment(rzp_res) {\n    document.body.style.overflow = null;\n\n    try {\n      setLoader({\n        state: true,\n        message: \"Capturing Payment...\"\n      });\n      const capture_res = await CartService.capture(rzp_res);\n\n      if (capture_res) {\n        navigate(\"/dashboard/cases\");\n        enqueueSnackbar(capture_res.message, {\n          variant: \"success\"\n        });\n        setTriggerCount(true);\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n    } finally {\n      setLoader({\n        state: false\n      });\n    }\n  }\n\n  async function handlePay() {\n    try {\n      setLoader({\n        state: true,\n        message: \"Initiating Payment...\"\n      });\n      const cart_res = await CartService.initiate();\n\n      if (cart_res) {\n        setCartDetails(cart_res);\n        setLoader({\n          state: false\n        });\n        openRazorPay({\n          order_id: cart_res.razorpayOrderId,\n          name: userObject === null || userObject === void 0 ? void 0 : userObject.name,\n          email: userObject === null || userObject === void 0 ? void 0 : userObject.email,\n          contact: userObject === null || userObject === void 0 ? void 0 : userObject.mobile,\n          handler: capturePayment\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n    } finally {\n      setLoader({\n        state: false\n      });\n    }\n  }\n\n  async function handleCaseSelection(cases, selectedCase) {\n    if ((cases === null || cases === void 0 ? void 0 : cases.length) >= 1 && !selectedCase) {\n      try {\n        setLoader({\n          state: true,\n          message: \"Modifying Cart...\"\n        });\n        await addAllCart([]);\n        await getCart(true);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\"\n        });\n        await removeAllCart([]);\n        await getCart(true);\n      } finally {\n        setLoader({\n          state: false\n        });\n      }\n    } else if ((cases === null || cases === void 0 ? void 0 : cases.length) === 0 && !selectedCase) {\n      try {\n        setLoader({\n          state: true,\n          message: \"Modifying Cart...\"\n        });\n        await removeAllCart([]);\n        await getCart(true);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\"\n        });\n        await getCart(true);\n      } finally {\n        setLoader({\n          state: false\n        });\n      }\n    } else {\n      try {\n        var _selectedCase$tableDa;\n\n        setLoader({\n          state: true,\n          message: \"Modifying Cart...\"\n        });\n        let newly_added_cases = [];\n        let newly_removed_cases = [];\n\n        if (selectedCase === null || selectedCase === void 0 ? void 0 : (_selectedCase$tableDa = selectedCase.tableData) === null || _selectedCase$tableDa === void 0 ? void 0 : _selectedCase$tableDa.checked) {\n          newly_added_cases = [selectedCase];\n        } else {\n          newly_removed_cases = _.filter(caseItems, c => (selectedCase === null || selectedCase === void 0 ? void 0 : selectedCase.id) === c.caseId);\n        }\n\n        let cart_items = [];\n\n        if (newly_added_cases.length) {\n          cart_items = await addCartItems(newly_added_cases);\n          setCaseItems([...caseItems, ...cart_items]);\n        }\n\n        if (newly_removed_cases.length) {\n          await removeCartItems(newly_removed_cases);\n          const afterRemovedItems = caseItems.filter(el => el.caseId !== selectedCase.id);\n          setCaseItems(afterRemovedItems);\n        }\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\"\n        });\n        await getCart(true);\n      } finally {\n        setLoader({\n          state: false\n        });\n      }\n    }\n  }\n\n  const detailPanel = [{\n    tooltip: \"View detailed split up...\",\n    render: rowData => {\n      return /*#__PURE__*/React.createElement(CartSplitUp, {\n        data: rowData,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 16\n        }\n      });\n    }\n  }];\n\n  const generateProfomaConfirmation = () => {\n    showAlert({\n      heading: \"You have requested to pay later\",\n      desc: `Upon choosing this option, a proforma invoice shall be generated which can be viewed in Payments.`,\n      //desc: `Proceeding further will generate a proforma invoice that you can pay later.`,\n      primaryBtnText: \"Yes, Generate\",\n      secondaryBtnText: \"Cancel\",\n      clickSecondarybtn: () => hideAlert(),\n      clickPrimaryBtn: () => {\n        hideAlert();\n        generateProforma();\n      },\n      isOpen: true,\n      descriptionTextStyle: {\n        marginBottom: 20\n      },\n      onDialogClose: () => hideAlert()\n    });\n  };\n\n  const generateProforma = async () => {\n    try {\n      setLoader({\n        state: true,\n        message: \"Generating Proforma Invoice...\"\n      });\n      const result = await CartService.generatePerforma();\n\n      if ((result === null || result === void 0 ? void 0 : result.status) === \"proformaGenerated\") {\n        enqueueSnackbar(\"Profoma invoice is generated Successfully\", {\n          variant: \"success\"\n        });\n        navigate(\"/dashboard/payments\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n    } finally {\n      setLoader({\n        state: false\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(Header, {\n    showSidebar: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(PageWrapper, {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Heading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 9\n    }\n  }, labels[\"appbar.case_cart\"]), /*#__PURE__*/React.createElement(TableWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CustomTable, {\n    selection: true,\n    onSelectionChange: handleCaseSelection // pageSize={50}\n    ,\n    columns,\n    data,\n    state,\n    placeholderText,\n    MTRef,\n    pageSize: (state === null || state === void 0 ? void 0 : (_state$data = state.data) === null || _state$data === void 0 ? void 0 : _state$data.length) == 0 ? 10 : 50,\n    detailPanel: detailPanel,\n    singularTitle: \"\",\n    pluralTitle: labels.cases,\n    hideFilterBar: true //noToolbar\n    ,\n    top: \"-25px\",\n    left: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Hr, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Payment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(PayLater, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 15\n    }\n  }, \"Would you like to pay later?\"), /*#__PURE__*/React.createElement(HyperLink, {\n    style: {\n      marginTop: 15,\n      width: 200\n    },\n    disabled: !caseItems.length,\n    onClick: () => caseItems.length && generateProfomaConfirmation(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 448,\n      columnNumber: 15\n    }\n  }, \"Generate Proforma Invoice\")), /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(TextWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 19\n    }\n  }, labels.payable_amount, \": \"), /*#__PURE__*/React.createElement(TextBold, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 462,\n      columnNumber: 19\n    }\n  }, \"INR \", _.sum(_.map(caseItems, \"amount\")).toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"highlighted\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 17\n    }\n  }, \"*All line items include 18% GST\")), /*#__PURE__*/React.createElement(Button, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(PrimaryCTAButton, {\n    disabled: !caseItems.length,\n    style: {\n      width: \"100%\"\n    },\n    onClick: handlePay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 17\n    }\n  }, labels.proceed)))))));\n};\n\nexport default Index;","map":{"version":3,"sources":["/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/internal/CaseCart/index.js"],"names":["React","useState","useEffect","useRef","PageWrapper","Heading","TableWrapper","Footer","Hr","Row","TextWrapper","Text","TextBold","HyperLink","StyledTitle","Payment","PayLater","Button","TopCenter","PrimaryCTAButton","CustomTable","Header","useRazorPay","queryString","CaseService","_","CartService","useLoader","useSnackbar","getErrorMessage","parseTimeStamp","renderStatus","addAllCart","addCartItems","removeAllCart","removeCartItems","useUser","moment","useCartCount","navigate","CLAIMENT_STR","PAYMENT_STATUS_CART","labels","CartSplitUp","useAlert","setIn","getCases","query","response","error","Index","openRazorPay","state","setState","caseItems","setCaseItems","cartDetails","setCartDetails","userObject","placeholderText","setLoader","MTRef","enqueueSnackbar","setTriggerCount","showAlert","hideAlert","getCart","toChange","current","onSearchChange","cart","cartItems","message","variant","unSelectAll","columns","field","title","tooltip","sorting","render","rowData","id","resolutionKind","cursor","agentRole","claimantParty","name","respondentParty","respondentName","marginLeft","Number","fee","total","toFixed","submittedOn","add","format","created_at","subscriptionKind","status","value","getCheckedData","found","find","item","caseId","data","Promise","resolve","params","page","perPage","inCart","search","orderBy","sort","sortDirection","orderDirection","stringParams","stringify","then","result","map","row","tableData","checked","lastPage","catch","capturePayment","rzp_res","document","body","style","overflow","capture_res","capture","handlePay","cart_res","initiate","order_id","razorpayOrderId","email","contact","mobile","handler","handleCaseSelection","cases","selectedCase","length","newly_added_cases","newly_removed_cases","filter","c","cart_items","afterRemovedItems","el","detailPanel","generateProfomaConfirmation","heading","desc","primaryBtnText","secondaryBtnText","clickSecondarybtn","clickPrimaryBtn","generateProforma","isOpen","descriptionTextStyle","marginBottom","onDialogClose","generatePerforma","position","marginTop","width","payable_amount","sum","proceed"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport {\n  PageWrapper,\n  Heading,\n  TableWrapper,\n  Footer,\n  Hr,\n  Row,\n  TextWrapper,\n  Text,\n  TextBold,\n  HyperLink,\n  StyledTitle,\n  Payment,\n  PayLater,\n  Button,\n  TopCenter,\n} from \"./Styles\";\nimport { PrimaryCTAButton } from \"../../common/Buttons\";\nimport CustomTable from \"../../common/CustomTable/CustomTable\";\nimport { Header } from \"../Header/Header\";\nimport useRazorPay from \"../../../hooks/useRazorPay\";\nimport queryString from \"query-string\";\nimport CaseService from \"../../../services/CaseService\";\nimport _ from \"lodash\";\nimport CartService from \"../../../services/CartService\";\nimport useLoader from \"../../../hooks/useLoader\";\nimport { useSnackbar } from \"notistack\";\nimport {\n  getErrorMessage,\n  parseTimeStamp,\n  renderStatus,\n} from \"../../../helpers/functions\";\nimport {\n  addAllCart,\n  addCartItems,\n  removeAllCart,\n  removeCartItems,\n} from \"./functions\";\nimport useUser from \"../../../hooks/useUser\";\nimport moment from \"moment\";\nimport useCartCount from \"../../../hooks/useCartCount\";\nimport { navigate } from \"@reach/router\";\nimport { CLAIMENT_STR, PAYMENT_STATUS_CART } from \"../../../helpers/constants\";\nimport labels from \"../../../helpers/labels.json\";\nimport { CartSplitUp } from \"../CartSplitUp\";\nimport useAlert from \"../../../hooks/useAlert\";\nimport { setIn } from \"formik\";\n\nasync function getCases(query = \"\") {\n  try {\n    const response = await CaseService.getCases(query);\n    return { ...response };\n  } catch (error) {\n    throw error;\n  }\n}\nconst Index = () => {\n  const openRazorPay = useRazorPay();\n  const [state, setState] = useState();\n  const [caseItems, setCaseItems] = useState([]);\n  // eslint-disable-next-line no-unused-vars\n  const [cartDetails, setCartDetails] = useState({});\n  const { userObject } = useUser();\n  const placeholderText = \"Search Cart\";\n  const { setLoader } = useLoader();\n  const MTRef = useRef();\n  const { enqueueSnackbar } = useSnackbar();\n  const { setTriggerCount } = useCartCount();\n  const { showAlert, hideAlert } = useAlert();\n  async function getCart(toChange = true) {\n    try {\n      const response = await CartService.getCart();\n      if (response) {\n        if (toChange) MTRef.current.onSearchChange(\"\");\n        setCartDetails(response.cart);\n        setCaseItems(response.cartItems);\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n    }\n  }\n  useEffect(() => {\n    async function unSelectAll() {\n      try {\n        await removeAllCart([]);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\",\n        });\n      }\n    }\n    unSelectAll();\n    // commented for https://app.clickup.com/t/3qev6h\n    // getCart();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (state?.message) {\n      enqueueSnackbar(state.message, {\n        variant: \"error\",\n      });\n      navigate(\"/dashboard\");\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state]);\n  const columns = [\n    {\n      field: \"id\",\n      title: labels[\"table.case_id\"],\n      tooltip: \"Unique Identifier for the Case across JustAct platform\",\n      sorting: false,\n      render: (rowData) => (\n        <HyperLink\n          onClick={() =>\n            navigate(\n              `/dashboard/cases/${rowData.id}?caseType=${rowData?.resolutionKind}`\n            )\n          }\n        >\n          <TopCenter>{rowData.id}</TopCenter>\n        </HyperLink>\n      ),\n    },\n    {\n      field: \"title\",\n      title: labels[\"table.case_title\"],\n      sorting: false,\n      render: (rowData) => (\n        <StyledTitle onClick={() => navigate(`/dashboard/cases/${rowData.id}`)}>\n          {rowData.title}\n        </StyledTitle>\n      ),\n    },\n    {\n      field: \"paryname\",\n      title: labels[\"table.party_name\"],\n      sorting: false,\n      render: (rowData) => (\n        <StyledTitle style={{ cursor: \"default\" }}>\n          {rowData?.agentRole === CLAIMENT_STR ? (\n            rowData?.claimantParty?.name\n          ) : (\n            <>\n              {rowData?.respondentParty?.name ? (\n                rowData.respondentParty.name\n              ) : rowData?.respondentName ? (\n                rowData.respondentName\n              ) : (\n                <div style={{ marginLeft: 35 }}>-</div>\n              )}\n            </>\n          )}\n        </StyledTitle>\n      ),\n    },\n    {\n      field: \"amount\",\n      title: labels[\"table.amount\"],\n      sorting: false,\n      render: (rowData) => \"INR \" + Number(rowData?.fee?.total).toFixed(2),\n    },\n    {\n      field: \"created_at\",\n      title: labels[\"table.due\"],\n      sorting: true,\n      render: (rowData) =>\n        rowData.submittedOn\n          ? moment(rowData.submittedOn).add(7, \"days\").format(\"DD/MM/YYYY\")\n          : moment(parseTimeStamp(rowData.created_at))\n              .add(7, \"days\")\n              .format(\"DD/MM/YYYY\"),\n    },\n    {\n      field: \"details\",\n      title: labels[\"table.description\"],\n      sorting: false,\n      render: (rowData) => (\n        <>\n          {rowData?.subscriptionKind === \"adhoc\"\n            ? \"Platform Fee\"\n            : renderStatus(\n                PAYMENT_STATUS_CART[rowData?.status]?.value,\n                rowData\n              )}\n        </>\n      ),\n    },\n  ];\n\n  function getCheckedData(rowData) {\n    const found = caseItems.find((item) => item.caseId === rowData.id);\n    if (found) {\n      return true;\n    }\n    return false;\n  }\n\n  const data = (query) =>\n    new Promise((resolve) => {\n      let params = {\n        page: query.page + 1,\n        perPage: 50,\n        inCart: true,\n      };\n      if (query.search) {\n        params.search = query.search;\n      }\n      if (query.orderBy?.field) {\n        params.sort = query.orderBy.field;\n        params.sortDirection = query.orderDirection;\n      }\n\n      let stringParams = `?${queryString.stringify(params)}`;\n      getCases(stringParams)\n        .then(async (result) => {\n          if (result) {\n            const rowData = result?.data?.map((row) => ({\n              ...row,\n              tableData: { checked: getCheckedData(row) },\n            }));\n            resolve({\n              data: rowData,\n              page: result.page - 1,\n              total: result.total,\n              lastPage: result.lastPage,\n            });\n            setState({\n              data: rowData,\n              page: result.page - 1,\n              total: result.total,\n              lastPage: result.lastPage,\n            });\n          }\n        })\n        .catch((error) => {\n          enqueueSnackbar(getErrorMessage(error), {\n            variant: \"error\",\n          });\n          setState({ data: [], lastPage: 1, page: 1, perPage: 10, total: 0 });\n          resolve({\n            data: [],\n            page: 0,\n            total: 0,\n          });\n        });\n    });\n\n  async function capturePayment(rzp_res) {\n    document.body.style.overflow = null;\n    try {\n      setLoader({ state: true, message: \"Capturing Payment...\" });\n      const capture_res = await CartService.capture(rzp_res);\n      if (capture_res) {\n        navigate(\"/dashboard/cases\");\n        enqueueSnackbar(capture_res.message, {\n          variant: \"success\",\n        });\n        setTriggerCount(true);\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n    } finally {\n      setLoader({ state: false });\n    }\n  }\n\n  async function handlePay() {\n    try {\n      setLoader({ state: true, message: \"Initiating Payment...\" });\n      const cart_res = await CartService.initiate();\n      if (cart_res) {\n        setCartDetails(cart_res);\n        setLoader({ state: false });\n        openRazorPay({\n          order_id: cart_res.razorpayOrderId,\n          name: userObject?.name,\n          email: userObject?.email,\n          contact: userObject?.mobile,\n          handler: capturePayment,\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n    } finally {\n      setLoader({ state: false });\n    }\n  }\n\n  async function handleCaseSelection(cases, selectedCase) {\n    if (cases?.length >= 1 && !selectedCase) {\n      try {\n        setLoader({ state: true, message: \"Modifying Cart...\" });\n        await addAllCart([]);\n        await getCart(true);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\",\n        });\n        await removeAllCart([]);\n        await getCart(true);\n      } finally {\n        setLoader({ state: false });\n      }\n    } else if (cases?.length === 0 && !selectedCase) {\n      try {\n        setLoader({ state: true, message: \"Modifying Cart...\" });\n        await removeAllCart([]);\n        await getCart(true);\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\",\n        });\n        await getCart(true);\n      } finally {\n        setLoader({ state: false });\n      }\n    } else {\n      try {\n        setLoader({ state: true, message: \"Modifying Cart...\" });\n        let newly_added_cases = [];\n        let newly_removed_cases = [];\n        if (selectedCase?.tableData?.checked) {\n          newly_added_cases = [selectedCase];\n        } else {\n          newly_removed_cases = _.filter(\n            caseItems,\n            (c) => selectedCase?.id === c.caseId\n          );\n        }\n        let cart_items = [];\n        if (newly_added_cases.length) {\n          cart_items = await addCartItems(newly_added_cases);\n          setCaseItems([...caseItems, ...cart_items]);\n        }\n        if (newly_removed_cases.length) {\n          await removeCartItems(newly_removed_cases);\n          const afterRemovedItems = caseItems.filter(\n            (el) => el.caseId !== selectedCase.id\n          );\n          setCaseItems(afterRemovedItems);\n        }\n      } catch (error) {\n        const message = getErrorMessage(error);\n        enqueueSnackbar(message, {\n          variant: \"error\",\n        });\n        await getCart(true);\n      } finally {\n        setLoader({ state: false });\n      }\n    }\n  }\n\n  const detailPanel = [\n    {\n      tooltip: \"View detailed split up...\",\n      render: (rowData) => {\n        return <CartSplitUp data={rowData} />;\n      },\n    },\n  ];\n\n  const generateProfomaConfirmation = () => {\n    showAlert({\n      heading: \"You have requested to pay later\",\n      desc: `Upon choosing this option, a proforma invoice shall be generated which can be viewed in Payments.`,\n      //desc: `Proceeding further will generate a proforma invoice that you can pay later.`,\n      primaryBtnText: \"Yes, Generate\",\n      secondaryBtnText: \"Cancel\",\n      clickSecondarybtn: () => hideAlert(),\n      clickPrimaryBtn: () => {\n        hideAlert();\n        generateProforma();\n      },\n      isOpen: true,\n      descriptionTextStyle: {\n        marginBottom: 20,\n      },\n      onDialogClose: () => hideAlert(),\n    });\n  };\n\n  const generateProforma = async () => {\n    try {\n      setLoader({ state: true, message: \"Generating Proforma Invoice...\" });\n      const result = await CartService.generatePerforma();\n      if (result?.status === \"proformaGenerated\") {\n        enqueueSnackbar(\"Profoma invoice is generated Successfully\", {\n          variant: \"success\",\n        });\n        navigate(\"/dashboard/payments\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n    } finally {\n      setLoader({ state: false });\n    }\n  };\n\n  return (\n    <Header showSidebar>\n      <PageWrapper style={{ position: \"relative\" }}>\n        <Heading>{labels[\"appbar.case_cart\"]}</Heading>\n        <TableWrapper>\n          <CustomTable\n            selection\n            onSelectionChange={handleCaseSelection}\n            // pageSize={50}\n            {...{\n              columns,\n              data,\n              state,\n              placeholderText,\n              MTRef,\n            }}\n            pageSize={state?.data?.length == 0 ? 10 : 50}\n            detailPanel={detailPanel}\n            singularTitle=\"\"\n            pluralTitle={labels.cases}\n            hideFilterBar\n            //noToolbar\n            top={\"-25px\"}\n            left={false}\n          />\n        </TableWrapper>\n        <Footer>\n          <Hr />\n          <Payment>\n            <PayLater>\n              <div>Would you like to pay later?</div>\n              <HyperLink\n                style={{ marginTop: 15, width: 200 }}\n                disabled={!caseItems.length}\n                onClick={() =>\n                  caseItems.length && generateProfomaConfirmation()\n                }\n              >\n                Generate Proforma Invoice\n              </HyperLink>\n            </PayLater>\n            <Row>\n              <div>\n                <TextWrapper>\n                  <Text>{labels.payable_amount}: </Text>\n                  <TextBold>\n                    INR {_.sum(_.map(caseItems, \"amount\")).toFixed(2)}\n                  </TextBold>\n                </TextWrapper>\n                <div className=\"highlighted\">\n                  *All line items include 18% GST\n                </div>\n              </div>\n              <Button>\n                <PrimaryCTAButton\n                  disabled={!caseItems.length}\n                  style={{\n                    width: \"100%\",\n                  }}\n                  onClick={handlePay}\n                >\n                  {labels.proceed}\n                </PrimaryCTAButton>\n              </Button>\n            </Row>\n          </Payment>\n        </Footer>\n      </PageWrapper>\n    </Header>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}