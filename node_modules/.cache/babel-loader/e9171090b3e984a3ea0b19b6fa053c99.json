{"ast":null,"code":"var _jsxFileName = \"/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/pages/LoginOTP/index.js\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { OTPContainer } from \"./styles\";\nimport { Center } from \"../../../styles/component/style\";\nimport { Otp } from \"../../common/Otp/Otp\";\nimport { Header } from \"../../internal/Header/Header\";\nimport { navigate } from \"@reach/router\";\nimport AuthService from \"../../../services/AuthService\";\nimport { getErrorMessage } from \"../../../helpers/functions\";\nimport { useSnackbar } from \"notistack\";\nimport _ from \"lodash\";\nimport useUser from \"../../../hooks/useUser\";\nimport useLoader from \"../../../hooks/useLoader\";\n\nconst Index = ({\n  location\n}) => {\n  const [value, setValue] = useState(\"\");\n  const {\n    state\n  } = location;\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    setToken\n  } = useUser();\n  const {\n    setLoader\n  } = useLoader();\n  const codeRef = useRef(undefined);\n  const [sending, setSending] = useState(false);\n\n  const resendOtp = async () => {\n    try {\n      setLoader({\n        state: true\n      });\n      const response = await AuthService.login(state.payload);\n\n      if (response) {\n        enqueueSnackbar(\"OTP Sent Successfully\", {\n          variant: \"success\"\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n    } finally {\n      setLoader({\n        state: false\n      });\n    }\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setLoader({\n        state: true\n      });\n      setSending(true);\n\n      let payload = _.pick(state.payload, [\"mobile\"]);\n\n      payload.otp = value;\n      const response = await AuthService.otpLogin(payload);\n\n      if (response && response.token) {\n        setToken(response.token);\n        navigate(\"/dashboard\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      console.log(error);\n      enqueueSnackbar(message, {\n        variant: \"error\"\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({\n        state: false\n      });\n      setSending(false);\n    }\n  };\n\n  const clearInputs = () => {\n    if (codeRef.current.textInput[0]) codeRef.current.textInput[0].focus();\n    codeRef.current.state.input[0] = \"\";\n    codeRef.current.state.input[1] = \"\";\n    codeRef.current.state.input[2] = \"\";\n    codeRef.current.state.input[3] = \"\";\n  };\n\n  const enterHandler = event => {\n    if (codeRef.current) {\n      if (codeRef.current.state.value.length === 4) {\n        if (event.key === \"Enter\") {\n          handleSubmit();\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    const enterHandler = event => {\n      if (!sending) {\n        if (codeRef.current) {\n          if (codeRef.current.state.value.length === 4) {\n            if (event.key === \"Enter\") {\n              handleSubmit();\n            }\n          }\n        }\n      }\n    };\n\n    window.addEventListener(\"keyup\", enterHandler);\n    return () => {\n      window.removeEventListener(\"keyup\", enterHandler);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, codeRef]);\n\n  const editTriggered = () => {\n    navigate(\"/login\", {\n      state: {\n        payload: state.values\n      }\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Center, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(OTPContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Otp, {\n    heading: \"LOGIN\",\n    disableSubmit: value.length < 4,\n    submitLabel: \"Proceed\",\n    phoneNumber: `${state === null || state === void 0 ? void 0 : state.payload.mobile}`,\n    timer: 60,\n    isTimmerEnabel: true,\n    triggerResent: resendOtp,\n    triggerEdit: editTriggered,\n    numberOfInput: 4,\n    inputName: \"otp\",\n    value: value,\n    setValue: setValue,\n    handleSubmit: handleSubmit,\n    showArrow: true,\n    codeRef: codeRef,\n    enterHandler: enterHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default Index;","map":{"version":3,"sources":["/home/justact/13-12-2021(Frontend Dev)/justact-fe/src/components/pages/LoginOTP/index.js"],"names":["React","useState","useRef","useEffect","OTPContainer","Center","Otp","Header","navigate","AuthService","getErrorMessage","useSnackbar","_","useUser","useLoader","Index","location","value","setValue","state","enqueueSnackbar","setToken","setLoader","codeRef","undefined","sending","setSending","resendOtp","response","login","payload","variant","error","message","handleSubmit","pick","otp","otpLogin","token","console","log","clearInputs","current","textInput","focus","input","enterHandler","event","length","key","window","addEventListener","removeEventListener","editTriggered","values","mobile"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { OTPContainer } from \"./styles\";\nimport { Center } from \"../../../styles/component/style\";\nimport { Otp } from \"../../common/Otp/Otp\";\nimport { Header } from \"../../internal/Header/Header\";\nimport { navigate } from \"@reach/router\";\nimport AuthService from \"../../../services/AuthService\";\nimport { getErrorMessage } from \"../../../helpers/functions\";\nimport { useSnackbar } from \"notistack\";\nimport _ from \"lodash\";\nimport useUser from \"../../../hooks/useUser\";\nimport useLoader from \"../../../hooks/useLoader\";\n\nconst Index = ({ location }) => {\n  const [value, setValue] = useState(\"\");\n  const { state } = location;\n  const { enqueueSnackbar } = useSnackbar();\n  const { setToken } = useUser();\n  const { setLoader } = useLoader();\n  const codeRef = useRef(undefined);\n  const [sending, setSending] = useState(false);\n\n  const resendOtp = async () => {\n    try {\n      setLoader({ state: true });\n      const response = await AuthService.login(state.payload);\n      if (response) {\n        enqueueSnackbar(\"OTP Sent Successfully\", {\n          variant: \"success\",\n        });\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n    } finally {\n      setLoader({ state: false });\n    }\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setLoader({ state: true });\n      setSending(true);\n      let payload = _.pick(state.payload, [\"mobile\"]);\n      payload.otp = value;\n      const response = await AuthService.otpLogin(payload);\n      if (response && response.token) {\n        setToken(response.token);\n        navigate(\"/dashboard\");\n      }\n    } catch (error) {\n      const message = getErrorMessage(error);\n      console.log(error);\n      enqueueSnackbar(message, {\n        variant: \"error\",\n      });\n      clearInputs();\n      console.log(error);\n    } finally {\n      setLoader({ state: false });\n      setSending(false);\n    }\n  };\n\n  const clearInputs = () => {\n    if (codeRef.current.textInput[0]) codeRef.current.textInput[0].focus();\n    codeRef.current.state.input[0] = \"\";\n    codeRef.current.state.input[1] = \"\";\n    codeRef.current.state.input[2] = \"\";\n    codeRef.current.state.input[3] = \"\";\n  };\n\n  const enterHandler = (event) => {\n    if (codeRef.current) {\n      if (codeRef.current.state.value.length === 4) {\n        if (event.key === \"Enter\") {\n          handleSubmit();\n        }\n      }\n    }\n  };\n  useEffect(() => {\n    const enterHandler = (event) => {\n      if (!sending) {\n        if (codeRef.current) {\n          if (codeRef.current.state.value.length === 4) {\n            if (event.key === \"Enter\") {\n              handleSubmit();\n            }\n          }\n        }\n      }\n    };\n    window.addEventListener(\"keyup\", enterHandler);\n    return () => {\n      window.removeEventListener(\"keyup\", enterHandler);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value, codeRef]);\n\n  const editTriggered = () => {\n    navigate(\"/login\", {\n      state: {\n        payload: state.values,\n      },\n    });\n  };\n  return (\n    <Header>\n      <Center>\n        <OTPContainer>\n          <Otp\n            heading=\"LOGIN\"\n            disableSubmit={value.length < 4}\n            submitLabel=\"Proceed\"\n            phoneNumber={`${state?.payload.mobile}`}\n            timer={60}\n            isTimmerEnabel={true}\n            triggerResent={resendOtp}\n            triggerEdit={editTriggered}\n            numberOfInput={4}\n            inputName=\"otp\"\n            value={value}\n            setValue={setValue}\n            handleSubmit={handleSubmit}\n            showArrow\n            codeRef={codeRef}\n            enterHandler={enterHandler}\n          />\n        </OTPContainer>\n      </Center>\n    </Header>\n  );\n};\n\nexport default Index;\n"]},"metadata":{},"sourceType":"module"}